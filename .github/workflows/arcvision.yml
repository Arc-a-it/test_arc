name: ArcVision Manual Architectural Override

on:
  workflow_dispatch:
  # This allows you to trigger the override manually after basic_v.yml identifies a risk/block

jobs:
  override-decision:
    runs-on: ubuntu-latest
    
    # Permission to push changes back to the repository
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install ArcVision CLI
        run: npm install -g arcvision

      - name: Execute Hardcoded Override
        run: |
          # -----------------------------------------------------------------
          # üöÄ PLACEHOLDER SECTION - EDIT THESE BEFORE RUNNING
          # -----------------------------------------------------------------
          EVENT_ID="evt_1769399887949_689qgi3f6" 
          REASON="Overriding architectural risk/block for critical deployment" 
          OWNER="adimeofarcvision"
          # -----------------------------------------------------------------
          
          echo "üõ°Ô∏è  Overriding decision for Event ID: $EVENT_ID"
          
          arcvision override --event-id "$EVENT_ID" \
                            --reason "$REASON" \
                            --owner "$OWNER"

      - name: Push Ledger Changes to GitHub
        run: |
          echo "üìù Syncing Authority Ledger..."
          git config --global user.name "ArcVision Governance Bot"
          git config --global user.email "governance@arcvision.ai"
          
          # Add the ledger file specifically
          git add arcvision_context/architecture.authority.ledger.json
          
          # Only commit if something changed
          if ! git diff --staged --quiet; then
            git commit -m "chore(governance): recorded override for $EVENT_ID"
            git push origin HEAD:${{ github.ref }}
            echo "‚úÖ Override successfully synced to github ledger."
          else
            echo "‚ö†Ô∏è  No changes to ledger detected. Check if Event ID is valid."
          fi
